# –õ–æ–≥ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π - 23 —è–Ω–≤–∞—Ä—è 2025, 14:30

## –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ –∏–∑ –¢–ó

### ‚úÖ 1. –°–ª–æ–∏ –∏ –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ —ç–ª–µ–º–µ–Ω—Ç–æ–≤ (Figma-like)

**–¢–∏–ø—ã (`src/types/index.ts`):**
- –î–æ–±–∞–≤–ª–µ–Ω —Ç–∏–ø `'group'` –≤ `ElementType`
- –†–∞—Å—à–∏—Ä–µ–Ω `BaseElement`: –ø–æ–ª—è `locked?`, `parentId?`
- –°–æ–∑–¥–∞–Ω `GroupElement`: `name`, `children[]`, `expanded?`, `rotation?`, `scaleX?`, `scaleY?`

**Store (`src/store/useStampStore.ts`):**
- **–ü–æ—Ä—è–¥–æ–∫ —ç–ª–µ–º–µ–Ω—Ç–æ–≤:**
  - `moveElementUp(id)` - –ø–µ—Ä–µ–º–µ—Å—Ç–∏—Ç—å –≤—ã—à–µ
  - `moveElementDown(id)` - –ø–µ—Ä–µ–º–µ—Å—Ç–∏—Ç—å –Ω–∏–∂–µ
  - `moveToTop(id)` - –Ω–∞ –ø–µ—Ä–µ–¥–Ω–∏–π –ø–ª–∞–Ω
  - `moveToBottom(id)` - –Ω–∞ –∑–∞–¥–Ω–∏–π –ø–ª–∞–Ω
  - `reorderElements(ids[])` - —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –Ω–æ–≤—ã–π –ø–æ—Ä—è–¥–æ–∫
- **–ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞:**
  - `createGroup(ids[], name?)` - —Å–æ–∑–¥–∞—Ç—å –≥—Ä—É–ø–ø—É
  - `ungroupElements(groupId)` - —Ä–∞–∑–≥—Ä—É–ø–ø–∏—Ä–æ–≤–∞—Ç—å
  - `addToGroup(groupId, ids[])` - –¥–æ–±–∞–≤–∏—Ç—å –≤ –≥—Ä—É–ø–ø—É
  - `removeFromGroup(groupId, ids[])` - —É–¥–∞–ª–∏—Ç—å –∏–∑ –≥—Ä—É–ø–ø—ã
  - `expandGroup(groupId, expanded)` - —Ä–∞—Å–∫—Ä—ã—Ç—å/—Å–≤–µ—Ä–Ω—É—Ç—å –≤ UI
- **–ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞:**
  - `toggleElementLock(id)` - –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å/—Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å

**–ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:**
- `GroupElement.tsx` - —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥ –≥—Ä—É–ø–ø —Å:
  - –†–µ–∫—É—Ä—Å–∏–≤–Ω—ã–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ–º –≤–ª–æ–∂–µ–Ω–Ω—ã—Ö –≥—Ä—É–ø–ø
  - –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ–º —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏–π (rotation, scale)
  - –í–∏–∑—É–∞–ª—å–Ω–æ–π —Ä–∞–º–∫–æ–π –ø—Ä–∏ –≤—ã–±–æ—Ä–µ
- `LayersPanel.tsx` - –ø–∞–Ω–µ–ª—å —Å–ª–æ—ë–≤ —Å:
  - Drag-and-drop (@dnd-kit)
  - –ö–Ω–æ–ø–∫–∞–º–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–æ—Ä—è–¥–∫–æ–º
  - –ë–ª–æ–∫–∏—Ä–æ–≤–∫–æ–π/–≤–∏–¥–∏–º–æ—Å—Ç—å—é
  - –ò–µ—Ä–∞—Ä—Ö–∏—á–µ—Å–∫–∏–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ–º
  - –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–º –≤—ã–±–æ—Ä–æ–º –¥–ª—è –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∏
- `Controls.tsx` - –¥–æ–±–∞–≤–ª–µ–Ω—ã —Ç–∞–±—ã "–ù–∞—Å—Ç—Ä–æ–π–∫–∏" / "–°–ª–æ–∏"
- `Canvas.tsx` - —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –±–µ–∑ parentId, —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥ –≥—Ä—É–ø–ø

**–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:** `@dnd-kit/core`, `@dnd-kit/sortable`, `@dnd-kit/utilities`

---

### ‚úÖ 2. –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–æ–≤ –≤ JSON (localStorage)

**–£—Ç–∏–ª–∏—Ç—ã (`src/utils/projectStorage.ts`):**
- –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å `StampProject`: id, name, elements, canvasSize, timestamps, thumbnail
- **–§—É–Ω–∫—Ü–∏–∏:**
  - `saveProject()` - —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å —Å –ø—Ä–µ–≤—å—é 200x200px
  - `loadProject()` - –∑–∞–≥—Ä—É–∑–∏—Ç—å –ø–æ ID
  - `listProjects()` - —Å–ø–∏—Å–æ–∫ —Å —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–æ–π –ø–æ –¥–∞—Ç–µ
  - `deleteProject()` - —É–¥–∞–ª–∏—Ç—å
  - `exportProjectAsJSON()` - —ç–∫—Å–ø–æ—Ä—Ç –≤ .json —Ñ–∞–π–ª
  - `importProjectFromJSON()` - –∏–º–ø–æ—Ä—Ç –∏–∑ —Ñ–∞–π–ª–∞
  - `generateThumbnail()` - —Å–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–µ–≤—å—é
  - `getStorageSize()`, `checkStorageAvailable()` - —É—Ç–∏–ª–∏—Ç—ã

**Store (`src/store/useStampStore.ts`):**
- –ü–æ–ª—è: `currentProjectId`, `currentProjectName`
- –ú–µ—Ç–æ–¥—ã:
  - `loadProjectData(project)` - –∑–∞–≥—Ä—É–∑–∏—Ç—å –ø—Ä–æ–µ–∫—Ç
  - `setCurrentProject(id, name)` - —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Ç–µ–∫—É—â–∏–π
  - `clearCanvas()` - –æ—á–∏—Å—Ç–∏—Ç—å —Ö–æ–ª—Å—Ç

**UI –∫–æ–º–ø–æ–Ω–µ–Ω—Ç (`src/components/ProjectManager/ProjectManager.tsx`):**
- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å–æ —Å–ø–∏—Å–∫–æ–º –ø—Ä–æ–µ–∫—Ç–æ–≤
- –ö–∞—Ä—Ç–æ—á–∫–∏ —Å –ø—Ä–µ–≤—å—é, –Ω–∞–∑–≤–∞–Ω–∏–µ–º, –¥–∞—Ç–æ–π
- –ü–æ–∏—Å–∫ –ø—Ä–æ–µ–∫—Ç–æ–≤
- –ö–Ω–æ–ø–∫–∏: –û—Ç–∫—Ä—ã—Ç—å, –≠–∫—Å–ø–æ—Ä—Ç, –£–¥–∞–ª–∏—Ç—å
- –ò–º–ø–æ—Ä—Ç –∏–∑ .json —Ñ–∞–π–ª–∞

**Header (`src/components/Header/Header.tsx`):**
- –ö–Ω–æ–ø–∫–∞ "–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –ø—Ä–æ–µ–∫—Ç" (–∑–µ–ª—ë–Ω–∞—è) - —Å–æ–∑–¥–∞—ë—Ç –ø—Ä–µ–≤—å—é, —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç
- –ö–Ω–æ–ø–∫–∞ "–ü—Ä–æ–µ–∫—Ç—ã" - –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç ProjectManager
- –ê–≤—Ç–æ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –Ω–∞–∑–≤–∞–Ω–∏—è –ø—Ä–∏ –ø–µ—Ä–≤–æ–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏

---

### ‚úÖ 3. SVGO –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è SVG

**–£—Ç–∏–ª–∏—Ç–∞ (`src/utils/svgOptimizer.ts`):**
- `optimizeSVG(svgString, options)` - –æ–ø—Ç–∏–º–∏–∑–∏—Ä—É–µ—Ç SVG
- –ü–∞—Ä–∞–º–µ—Ç—Ä—ã: `precision`, `removeComments`, `removeMetadata`
- –ü–ª–∞–≥–∏–Ω—ã SVGO:
  - preset-default (—Å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º viewBox –∏ ID)
  - cleanupNumericValues (precision: 2)
  - mergePaths, convertShapeToPath
  - removeUselessDefs, removeEmptyContainers
  - removeDimensions (–¥–ª—è –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç–∏)
- `getOptimizationStats()` - —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏
- `optimizeSVGWithStats()` - –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è + —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞

**–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç—å:** `svgo`

---

### ‚úÖ 4. –≠–∫—Å–ø–æ—Ä—Ç –æ—Ç–¥–µ–ª—å–Ω—ã—Ö SVG —ç–ª–µ–º–µ–Ω—Ç–æ–≤

**–§—É–Ω–∫—Ü–∏—è (`src/utils/export.ts`):**
- `exportElementToSVG(element, filename?)` - —ç–∫—Å–ø–æ—Ä—Ç —ç–ª–µ–º–µ–Ω—Ç–∞ –≤ SVG
- **–ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Ç–∏–ø–æ–≤:**
  - `icon` - –ø–æ–ª—É—á–∞–µ—Ç SVG –∏–∑ lucide/heroicons/custom, –ø—Ä–∏–º–µ–Ω—è–µ—Ç —Å—Ç–∏–ª–∏
  - `circle` - —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç –∫–∞–∫ SVG circle
  - `rectangle` - —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç –∫–∞–∫ SVG rect
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ SVGO
- –ì–µ–Ω–µ—Ä–∞—Ü–∏—è standalone SVG —Å viewBox
- –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ fill/stroke –∏–∑ –Ω–∞—Å—Ç—Ä–æ–µ–∫ —ç–ª–µ–º–µ–Ω—Ç–∞

**–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è:** —Ñ—É–Ω–∫—Ü–∏—è –≥–æ—Ç–æ–≤–∞ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é –≤ UI (–∫–Ω–æ–ø–∫–∏ –≤ Controls)

---

## üì¶ –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

```bash
npm install @dnd-kit/core @dnd-kit/sortable @dnd-kit/utilities potrace-wasm svgo
```

---

## üìÅ –°–æ–∑–¥–∞–Ω–Ω—ã–µ/–º–æ–¥–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

### –°–æ–∑–¥–∞–Ω–Ω—ã–µ:
- `src/components/Canvas/elements/GroupElement.tsx` - —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥ –≥—Ä—É–ø–ø
- `src/components/Controls/LayersPanel.tsx` - –ø–∞–Ω–µ–ª—å —Å–ª–æ—ë–≤ —Å DnD
- `src/components/ProjectManager/ProjectManager.tsx` - –º–µ–Ω–µ–¥–∂–µ—Ä –ø—Ä–æ–µ–∫—Ç–æ–≤
- `src/utils/projectStorage.ts` - —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ/–∑–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–æ–µ–∫—Ç–æ–≤
- `src/utils/svgOptimizer.ts` - SVGO –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è

### –ú–æ–¥–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ:
- `src/types/index.ts` - –Ω–æ–≤—ã–µ —Ç–∏–ø—ã –∏ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã
- `src/store/useStampStore.ts` - –º–µ—Ç–æ–¥—ã —Å–ª–æ—ë–≤, –≥—Ä—É–ø–ø, –ø—Ä–æ–µ–∫—Ç–æ–≤
- `src/components/Canvas/Canvas.tsx` - —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è + GroupElement
- `src/components/Controls/Controls.tsx` - —Ç–∞–±—ã –ù–∞—Å—Ç—Ä–æ–π–∫–∏/–°–ª–æ–∏
- `src/components/Header/Header.tsx` - –∫–Ω–æ–ø–∫–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è/–∑–∞–≥—Ä—É–∑–∫–∏
- `src/utils/export.ts` - exportElementToSVG

---

## ‚ö†Ô∏è –ù–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ –∏–∑ –¢–ó

1. **Potrace WASM** –¥–ª—è –ß–ë –ª–æ–≥–æ—Ç–∏–ø–æ–≤ (–∑–∞–¥–∞—á–∞ 3 –∏–∑ –¢–ó)
   - –ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞
   - –§—É–Ω–∫—Ü–∏—è `vectorizeWithPotrace()` –Ω–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞
   - VectorizationDialog –Ω–µ —Å–æ–∑–¥–∞–Ω
   - –ù–µ –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω–æ –≤ Toolbar

2. **UI –∫–Ω–æ–ø–∫–∏ —ç–∫—Å–ø–æ—Ä—Ç–∞** —ç–ª–µ–º–µ–Ω—Ç–æ–≤
   - –§—É–Ω–∫—Ü–∏—è exportElementToSVG —Å–æ–∑–¥–∞–Ω–∞
   - –ö–Ω–æ–ø–∫–∏ –≤ Controls –¥–ª—è IconElement –Ω–µ –¥–æ–±–∞–≤–ª–µ–Ω—ã

---

## üß™ –°—Ç–∞—Ç—É—Å —Å–±–æ—Ä–∫–∏

‚úÖ **–ü—Ä–æ–µ–∫—Ç –∫–æ–º–ø–∏–ª–∏—Ä—É–µ—Ç—Å—è**
- –°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –æ—à–∏–±–∫–∏ –≤ AdminPanel.tsx (–±—ã–ª–∏ –¥–æ –∏–∑–º–µ–Ω–µ–Ω–∏–π)
- –í—Å–µ –Ω–æ–≤—ã–µ —Ñ–∞–π–ª—ã –±–µ–∑ –æ—à–∏–±–æ–∫ TypeScript

---

## üéØ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. –î–æ–±–∞–≤–∏—Ç—å –∫–Ω–æ–ø–∫—É "–≠–∫—Å–ø–æ—Ä—Ç SVG" –≤ Controls –¥–ª—è IconElement
2. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å Potrace –≤–µ–∫—Ç–æ—Ä–∏–∑–∞—Ü–∏—é (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
3. –°–æ–∑–¥–∞—Ç—å VectorizationDialog —Å –≤—ã–±–æ—Ä–æ–º –∞–ª–≥–æ—Ä–∏—Ç–º–∞
4. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö —Ñ—É–Ω–∫—Ü–∏–π
