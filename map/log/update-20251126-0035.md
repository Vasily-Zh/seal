# Исправление: переключение шрифтов для кругового текста

**Дата:** 2025-11-26 00:35

## Проблема
Шрифты не переключались для текстовых элементов по кругу (TextElement с curved=true). При выборе нового шрифта в интерфейсе текст оставался с прежним шрифтом.

## Причина
Функция `loadFont()` в `textToPath.ts` получала имя шрифта с fallback'ами (например, `"Comic Sans MS, cursive, sans-serif"`), но искала точное совпадение в словарях шрифтов, где ключи были без fallback'ов (например, `"Comic Sans MS"`). Это приводило к тому, что шрифт не находился и происходил fallback на Roboto для всех шрифтов.

## Решение

### 1. Исправлен парсинг имени шрифта (`src/utils/textToPath.ts`)
- Добавлено извлечение основного имени шрифта из строки с fallback'ами
- Теперь `"Comic Sans MS, cursive, sans-serif"` → `"Comic Sans MS"`
- Парсинг применяется перед поиском в словарях `systemFontUrls` и `googleFontUrls`

### 2. Улучшены зависимости в хуке (`src/hooks/useCurvedTextVectorization.ts`)
- Развернуты props для явных зависимостей в `useMemo` и `useEffect`
- Вместо зависимости от объекта `props` используются конкретные поля
- Это гарантирует перерасчет при изменении любого параметра, включая `fontFamily`

## Измененные файлы
- `src/utils/textToPath.ts:78-130` - Добавлен парсинг primaryFontFamily
- `src/hooks/useCurvedTextVectorization.ts:26-91` - Явные зависимости для React hooks

## Результат
✅ Шрифты теперь корректно переключаются для кругового текста
✅ Каждый шрифт загружается один раз и кэшируется
✅ При смене шрифта создается новый кэш-ключ и загружается нужный шрифт
